/*! gallifreyan - v0.0.1 - 2016-05-22 */
!function(a){var b=a.gallifreyan||{};a.gallifreyan=b;Math.TWOPI=2*Math.PI,Math.HALFPI=Math.PI/2,Math.THREEQUARTERSPI=Math.PI+Math.HALFPI,b.options={guidelinesEnabled:!1,guidelinesColor:"#000000"},b.Graphic=function(a){this.name="Graphic",this.canvas="undefined"!=typeof a?a:null,this.line_color="#f0cc05",this.line_width=2,this.visible=!0},b.Graphic.prototype._draw=function(a){a.strokeStyle=this.line_color,a.lineWidth=this.line_width,a.lineCap="round"},b.Graphic.prototype.draw=function(a){if(this.visible&&("undefined"!=typeof a&&(this.canvas=a),"undefined"!=typeof this.canvas&&null!==this.canvas)){var b=this.canvas.getContext("2d");b.beginPath(),this._draw(b),b.stroke()}},b.Point=function(a,b,c){this.name="Point",this.x="undefined"!=typeof a?a:0,this.y="undefined"!=typeof b?b:0,"number"==typeof c&&(this.line_width=c)},b.Point.prototype=new b.Graphic,b.Point.prototype._pre_draw=b.Point.prototype._draw,b.Point.prototype._draw=function(a){this._pre_draw(a);var b=this.line_width/2.01;a.arc(this.x,this.y,b,0,Math.TWOPI)},b.Point.prototype.moveXY=function(a,b){return this.x+=a,this.y+=b,this},b.Point.prototype.move=function(a,b){return this.moveXY(Math.cos(a)*b,Math.sin(a)*b),this},b.Point.prototype.isMouseOver=function(a,b){var c=Math.max(5,this.line_width);if(a<this.x-c||a>this.x+c||b<this.y-c||b>this.y+c)return!1;var d=a-this.x,e=b-this.y,f=Math.sqrt(d*d+e*e);return c>=f&&f>=-c},b.Line=function(a,c,d,e){this.name="Line",this.begin=new b.Point(a,c),this.end=new b.Point(d,e)},b.Line.prototype=new b.Graphic,b.Line.prototype._pre_draw=b.Line.prototype._draw,b.Line.prototype._draw=function(a){this._pre_draw(a),a.moveTo(this.begin.x,this.begin.y),a.lineTo(this.end.x,this.end.y)},b.Line.prototype.boxContains=function(a){if("undefined"==typeof a)return!1;var b=0,c=0,d=0,e=0;return this.begin.x<this.end.x?(b=this.begin.x,c=this.end.x):(b=this.end.x,c=this.begin.x),this.begin.y<this.end.y?(d=this.begin.y,e=this.end.y):(d=this.end.y,e=this.begin.y),a.x>=b&&a.x<=c&&a.y>=d&&a.y<=e},b.Line.prototype.intersectPoints=function(a){var c=[];if("undefined"==typeof a||null===a)return c;if("undefined"==typeof a.name||null===a.name)return c;if("Circle"==a.name){var d=[],e=b.util.isect_line_circle(this,a);for(var f in e){var g=e[f];this.boxContains(g)&&d.push(g)}return d}return c},b.Line.prototype.perpendicularMove=function(a){if(this.begin.x==this.end.x)this.begin.y+=a;else if(this.begin.y==this.end.y)this.begin.x+=a;else{var b=Math.atan2(this.end.y-this.begin.y,this.end.x-this.begin.x);this.begin.move(b+Math.HALFPI,a),this.end.move(b+Math.HALFPI,a)}return this},b.Line.prototype.isMouseOver=function(a,c){var d,e,f,g,h,i,j=Math.max(5,this.line_width/2),k=Math.min(this.begin.x,this.end.x)-j,l=Math.min(this.begin.y,this.end.y)-j,m=Math.max(this.begin.x,this.end.x)+j,n=Math.max(this.begin.y,this.end.y)+j;if(k>a||l>c||a>m||c>n)return!1;var o=this.end.x-this.begin.x,p=this.end.y-this.begin.y;return Math.abs(o)>.001?(d=p/o,e=this.begin.y-d*this.begin.x,f=g=h=i=0,d>.001||-.001>d?(f=Math.tan(Math.atan(d)+Math.HALFPI),g=c-f*a,h=(g-e)/(d-f),i=d*h+e):(f=d,g=a-f*c,h=(f*e+g)/(1-d*f),i=d*h+e),b.util.points_distance(a,c,h,i)<=j):(d=o/p,e=this.begin.x-d*this.begin.y,f=g=h=i=0,d>.001||-.001>d?(f=Math.tan(Math.atan(d)+Math.HALFPI),g=a-f*c,i=(g-e)/(d-f),h=d*i+e):(f=d,g=c-f*a,i=(f*e+g)/(1-d*f),h=d*i+e),b.util.points_distance(a,c,h,i)<=j)},b.Circle=function(a,c,d){this.name="Circle",this.center=new b.Point(a,c),this.radius="undefined"!=typeof d?d:1},b.Circle.prototype=new b.Graphic,b.Circle.prototype._pre_draw=b.Circle.prototype._draw,b.Circle.prototype._draw=function(a){this._pre_draw(a),a.arc(this.center.x,this.center.y,this.radius,0,Math.TWOPI)},b.Circle.prototype.intersectPoints=function(a){var c=[];return"undefined"==typeof a||null===a?c:"undefined"==typeof a.name||null===a.name?c:"Circle"==a.name?b.util.isect_circle_circle(this,a):"Line"==a.name?b.util.isect_line_circle(a,this):c},b.Circle.prototype.isMouseOver=function(a,b){var c=a-this.center.x,d=b-this.center.y,e=Math.sqrt(c*c+d*d),f=Math.max(5,this.line_width/2);return e<=this.radius+f&&e>=this.radius-f},b.Arc=function(a,c,d,e,f){this.name="Arc",this.circle=new b.Circle(a,c,d),this.begin_angle="undefined"!=typeof e?e:0,this.end_angle="undefined"!=typeof f?f:Math.TWOPI},b.Arc.prototype=new b.Graphic,b.Arc.prototype._pre_draw=b.Arc.prototype._draw,b.Arc.prototype._draw=function(a){this._pre_draw(a),a.arc(this.circle.center.x,this.circle.center.y,this.circle.radius,this.begin_angle,this.end_angle)},b.Arc.prototype.intersectPoints=function(a){var c,d,e,f,g=[];if("undefined"==typeof a)return g;if("undefined"==typeof a.name)return g;if("Line"==a.name){e=b.util.isect_line_circle(a,this.circle),f=[];for(c in e)d=e[c],this.containsPoint(d)&&a.boxContains(d)&&f.push(d);return f}if("Circle"==a.name){e=b.util.isect_circle_circle(this.circle,a),f=[];for(c in e)d=e[c],this.containsPoint(d)&&f.push(d);return f}if("Arc"==a.name){e=b.util.isect_circle_circle(this.circle,a.circle),f=[];for(c in e)d=e[c],this.containsPoint(d)&&a.containsPoint(d)&&f.push(d);return f}return g},b.Arc.prototype.containsPoint=function(a){if("undefined"==typeof a)return!1;var b=Math.atan2(a.y-this.circle.center.y,a.x-this.circle.center.x);return b>=this.begin_angle&&b<=this.end_angle?!0:!1},b.Arc.prototype.isMouseOver=function(a,b){if(!this.circle.isMouseOver(a,b))return!1;for(var c=Math.atan2(b-this.circle.center.y,a-this.circle.center.x),d=this.begin_angle,e=this.end_angle;d>e;)d-=Math.TWOPI;e>Math.PI&&c<e-Math.TWOPI&&(c+=Math.TWOPI),d<-Math.PI&&c>d+Math.TWOPI&&(c-=Math.TWOPI);var f=c>=d&&e>=c;return f},b.Sentence=function(a,c,d,e){this.text="undefined"!=typeof a?a:"",this.size="undefined"!=typeof e?e:300,this.left="undefined"!=typeof c?c:0,this.top="undefined"!=typeof d?d:0,this.center_x=this.left+this.size/2,this.center_y=this.top+this.size/2,this.outside_circle=new b.Circle(this.center_x,this.center_y,this.size/2),this.outside_circle.line_width*=1.4,this.inside_circle=new b.Circle(this.center_x,this.center_y,this.size/2-this.outside_circle.line_width-1),this.words=[],this.setText(a)},b.Sentence.prototype.draw=function(a){var b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);var c=b.createLinearGradient(0,0,a.width,a.height);c.addColorStop(0,"#00345c"),c.addColorStop(1,"#00112b"),b.fillStyle=c,b.fillRect(0,0,a.width,a.height),this.outside_circle.draw(a),this.inside_circle.draw(a);var d=null;for(d in this.words)this.words[d].draw(a)},b.Sentence.prototype.setText=function(a){var c=null,d=null,e=null;this.words=[],this.text=this.preprocessText(a.trim());var f=.95*this.inside_circle.radius,g=this.text.split(" ");if(g&&1==g.length)e=new b.Word(g[0],this.center_x,this.center_y,2*f,this.inside_circle),this.words.push(e);else{var h=-Math.TWOPI/g.length,i=Math.PI/2,j=Math.abs(Math.sin(h/2)),k=f*j/(1+j),l=f-k;for(c in g){d=g[c];var m=Math.sin(i),n=Math.cos(i),o=this.center_x+l*n,p=this.center_y+l*m;e=new b.Word(d,o,p,2*k,this.inside_circle),this.words.push(e),i+=h}}this.shareModLines()},b.Sentence.prototype.preprocessText=function(a){for(var b,c,d=/[a-z ]/i,e=/[ei]/i,f="",g=0;g<a.length;++g)c=a[g],d.test(c)&&("c"==c?a.length>g+1?(b=a[g+1],f+=e.test(b)?"s":"k"):f+="k":"q"==c?a.length>g+1?(b=a[g+1],f+="u"===b?"q":"k"):f+="k":f+=c);return f},b.Sentence.prototype.shareModLines=function(){var a,b,c,d,e,f=[];for(a=0;a<this.words.length;++a)for(c=this.words[a],b=0;b<c.chars.length;++b)d=c.chars[b],d.clearSharedLines(),f.push(d);for(a=0;a<f.length;++a)for(d=f[a],b=a+1;b<f.length&&(e=f[b],!d.shareModLines(e));++b);},b.Sentence.prototype.mouseOverObjects=function(a,b){var c=[];this.outside_circle.isMouseOver(a,b)&&c.push(this.outside_circle),this.inside_circle.isMouseOver(a,b)&&c.push(this.inside_circle);for(var d in this.words){var e=this.words[d].mouseOverObjects(a,b);for(var f in e){var g=e[f];c.push(g)}}return c},b.Sentence.prototype.setLineColor=function(a){this.inside_circle.line_color=a,this.outside_circle.line_color=a;for(var b in this.words)this.words[b].setLineColor(a)},b.Word=function(a,c,d,e,f){this.max_diameter="undefined"!=typeof e?e:250,this.radius=this.max_diameter/2,this.x="undefined"!=typeof c?c:this.radius,this.y="undefined"!=typeof d?d:this.radius,this.circle=new b.Circle(this.x,this.y,this.radius),this.circle.line_color=b.options.guidelinesColor,this.circle.line_width=1,this.sentence_circle="undefined"!=typeof f?f:this.circle,this.arcs_circle=new b.Circle(this.x,this.y,this.radius),this.arcs_circle.line_color=b.options.guidelinesColor,this.arcs_circle.line_width=1,this.arcs=[new b.Arc(this.x,this.y,this.radius,0,Math.TWOPI)],this.text="",this.chars=[],this.setText(a)},b.Word.prototype.draw=function(a){var c=null,d=null;for(c in this.arcs)d=this.arcs[c],d.draw(a);for(c in this.chars)this.chars[c].draw(a);b.options.guidelinesEnabled&&(this.circle.draw(a),this.arcs_circle.draw(a))},b.Word.prototype.setText=function(a){this.text=a=a.trim().split(" ")[0],this.chars=[];for(var c=0,d=null;a.length>0&&c!=a.length;)d=new b.Char(a),this.chars.push(d),c=a.length,a=a.substr(d.main.length*d.main_count+d.secondary.length*d.secondary_count);this.setDimensions()},b.Word.prototype.setDimensions=function(){if(this.chars&&!(this.chars.length<=0)){var a=20;if(this.chars.length>0){if(1==this.chars.length)this.arcs_circle.center.y=this.y-.15*this.radius,this.arcs_circle.radius=.7*this.radius,a=this.max_diameter;else{this.arcs_circle.center.y=this.y;var b=Math.TWOPI/this.chars.length/2,c=Math.sin(b);a=2*this.arcs_circle.radius*c;var d=this.positionChars(a,!0);this.arcs_circle.radius=d.radius,this.arcs_circle.center.x=d.center.x,this.arcs_circle.center.y=d.center.y,a=2*this.arcs_circle.radius*c,2==this.chars.length&&(a*=.93)}this.positionChars(a)}}},b.Word.prototype.positionChars=function(a,c){c="boolean"!=typeof c?!1:c;var d,e,f,g=Math.PI/2,h=-Math.TWOPI/this.chars.length,i=[],j=!0,k=null,l=new b.Point(this.arcs_circle.center.x,this.arcs_circle.center.y);for(d in this.chars){if(e=this.chars[d],e.sentence_circle=this.sentence_circle,e.up_angle=g+Math.PI,e.up_vector=new b.Point(Math.cos(e.up_angle),Math.sin(e.up_angle)),e.word_circle=this.arcs_circle,e.x=this.arcs_circle.center.x+this.arcs_circle.radius*Math.cos(g),e.y=this.arcs_circle.center.y+this.arcs_circle.radius*Math.sin(g),e.setMaxDiameter(a),f=e.word_intersect_points,2==f.length){var m=f[0],n=f[1],o=Math.atan2(m.y-this.arcs_circle.center.y,m.x-this.arcs_circle.center.x),p=Math.atan2(n.y-this.arcs_circle.center.y,n.x-this.arcs_circle.center.x),q=!1;if((o>Math.HALFPI&&p<Math.HALFPI||p>Math.HALFPI&&o<Math.HALFPI)&&(q=!0),o=b.util.normalize_angle(o,-Math.THREEQUARTERSPI),p=b.util.normalize_angle(p,-Math.THREEQUARTERSPI),p>o||j&&o>-Math.PI&&p<-Math.PI){var r=o;o=p,p=r}j?(j=!1,q?(k=p,i.push(o)):(k=o-Math.TWOPI,i.push(p))):(i.push(o),i.push(p))}c&&(l.x+=e.max_used_word_radius*Math.cos(e.up_angle)/this.chars.length,l.y+=e.max_used_word_radius*Math.sin(e.up_angle)/this.chars.length),g+=h}if(k&&i.push(k),i.length>0)for(this.arcs=[],d=0;d<i.length-1;d+=2)this.addArc(i[d+1],i[d]);else this.arcs=[new b.Arc(this.arcs_circle.center.x,this.arcs_circle.center.y,this.arcs_circle.radius,0,Math.TWOPI)];var s=this.arcs_circle;if(c){var t=this.radius;for(d in this.chars){e=this.chars[d];var u=l.x-e.up_vector.x*this.max_diameter,v=l.y-e.up_vector.y*this.max_diameter,w=new b.Line(l.x,l.y,u,v);if(f=w.intersectPoints(this.circle),f.length>0){var x=f[0],y=x.x-l.x,z=x.y-l.y,A=.94*Math.sqrt(y*y+z*z);A-=e.max_used_word_radius-this.arcs_circle.radius,t=Math.min(t,A)}}s=new b.Circle(l.x,l.y,t)}return s},b.Word.prototype.addArc=function(a,c){this.arcs.push(new b.Arc(this.arcs_circle.center.x,this.arcs_circle.center.y,this.arcs_circle.radius,a,c))},b.Word.prototype.mouseOverObjects=function(a,b){var c,d,e=[];for(c in this.arcs){var f=this.arcs[c];f.isMouseOver(a,b)&&e.push(f)}for(c in this.chars){var g=this.chars[c].mouseOverObjects(a,b);if(g.length>0)for(d in g)e.push(g[d])}return e},b.Word.prototype.setLineColor=function(a){var b;for(b in this.arcs)this.arcs[b].line_color=a;for(b in this.chars)this.chars[b].setLineColor(a)},b.Char=function(a,c,d,e,f,g,h){this.draw_objects=[],this.max_circle=null,this.owner_intersect_object=null,this.x="undefined"!=typeof c?c:this.radius,this.y="undefined"!=typeof d?d:this.radius,this.up_angle=-Math.HALFPI,this.up_vector="undefined"!=typeof f?f:new b.Point(0,-1),this.word_circle="undefined"!=typeof g?g:new b.Circle(0,0,1),this.sentence_circle="undefined"!=typeof h?h:this.word_circle,this.word_intersect_points=[],this.main="",this.main_count=0,this.secondary="",this.secondary_count=0,this.text="",this.getFirstChar(a),this.max_used_word_radius=this.word_circle.radius+this.radius,this.setMaxDiameter(e),this.dots=[],this.main_mod=null,this.secondary_mod=null,this.mod_lines=[],this.mod_line_secondary=null},b.Char.prototype.setX=function(a){this.x="undefined"!=typeof a?a:this.radius,this.loadObjects()},b.Char.prototype.setY=function(a){this.y="undefined"!=typeof a?a:this.radius,this.loadObjects()},b.Char.prototype.setMaxDiameter=function(a){this.max_diameter="undefined"!=typeof a?a:50,this.radius=this.max_diameter/2,this.consonant_radius=.45*this.radius,this.vowel_radius=.3*this.consonant_radius,this.max_circle||(this.max_circle=new b.Circle),this.max_circle.center.x=this.x,this.max_circle.center.y=this.y,this.max_circle.radius=this.max_diameter/2,this.max_circle.line_color=b.options.guidelinesColor,this.max_circle.line_width=1,this.loadObjects()},b.Char.prototype.draw=function(a){var c=null;for(c in this.draw_objects)this.draw_objects[c].draw(a);b.options.guidelinesEnabled&&this.max_circle&&this.max_circle.draw(a)},b.Char.prototype.loadObjects=function(){if(this.draw_objects=[],!(!this.main||this.main.length<=0||this.main_count<=0)){var a=null;/^([bdfgh]|ch)$/i.test(this.main)?("ch"==this.main?a="2dots":"d"==this.main?a="3dots":"f"==this.main?a="3lines":"g"==this.main?a="1line":"h"==this.main&&(a="2lines"),this.loadB(a)):/^[jklmnp]$/i.test(this.main)?("k"==this.main?a="2dots":"l"==this.main?a="3dots":"m"==this.main?a="3lines":"n"==this.main?a="1line":"p"==this.main&&(a="2lines"),this.loadJ(a)):/^([trsvw]|sh)$/i.test(this.main)?("sh"==this.main?a="2dots":"r"==this.main?a="3dots":"s"==this.main?a="3lines":"v"==this.main?a="1line":"w"==this.main&&(a="2lines"),this.loadT(a)):/^([yzx]|th|ng|qu)$/i.test(this.main)?("y"==this.main?a="2dots":"z"==this.main?a="3dots":"ng"==this.main?a="3lines":"qu"==this.main?a="1line":"x"==this.main&&(a="2lines"),this.loadTH(a)):/^a$/i.test(this.main)?this.loadA(this.word_circle):/^e$/i.test(this.main)?this.loadE(this.word_circle):/^i$/i.test(this.main)?this.loadI(this.word_circle):/^o$/i.test(this.main)?this.loadO(this.word_circle):/^u$/i.test(this.main)?this.loadU(this.word_circle):this.loadOther()}},b.Char.prototype.loadModifier=function(a,c,d,e){var f,g,h,i,j,k,l,m=.07*this.consonant_radius,n=.1*this.consonant_radius,o=c.radius/Math.PI;switch(this.dots=[],this.mod_lines=[],a){case"3dots":k=(this.up_angle*o-n)/o,h=new b.Point(c.center.x+Math.cos(k)*(c.radius-1.8*n),c.center.y+Math.sin(k)*(c.radius-1.8*n),m),this.dots.push(h),this.draw_objects.push(h),f=new b.Point(c.center.x+this.up_vector.x*(c.radius-1.8*n),c.center.y+this.up_vector.y*(c.radius-1.8*n),n),this.dots.push(f),this.draw_objects.push(f),j=(this.up_angle*o+n)/o,g=new b.Point(c.center.x+Math.cos(j)*(c.radius-1.8*n),c.center.y+Math.sin(j)*(c.radius-1.8*n),m),this.dots.push(g),this.draw_objects.push(g);break;case"2dots":i=(this.up_angle*o-m/1.8)/o,f=new b.Point(c.center.x+Math.cos(i)*(c.radius-1.5*n),c.center.y+Math.sin(i)*(c.radius-1.5*n),m),this.draw_objects.push(f),j=(this.up_angle*o+m/1.8)/o,g=new b.Point(c.center.x+Math.cos(j)*(c.radius-1.5*n),c.center.y+Math.sin(j)*(c.radius-1.5*n),m),this.draw_objects.push(g);break;case"2lines":l=b.util.randomize_angles(2,d,e),this.loadModifierLine(c,l[0]),this.loadModifierLine(c,l[1]);break;case"3lines":l=b.util.randomize_angles(3,d,e),this.loadModifierLine(c,l[0]),this.loadModifierLine(c,l[1]),this.loadModifierLine(c,l[2]);break;case"1line":l=b.util.randomize_angles(1,d,e),this.loadModifierLine(c,l[0])}},b.Char.prototype.loadModifierLine=function(a,c,d){"undefined"==typeof d&&(d=!1);var e=new b.Line(a.center.x+Math.cos(c)*(a.radius+a.line_width/2),a.center.y+Math.sin(c)*(a.radius+a.line_width/2),a.center.x+Math.cos(c)*this.sentence_circle.radius*2,a.center.y+Math.sin(c)*this.sentence_circle.radius*2),f=e.intersectPoints(this.sentence_circle);f.length>0&&(e.end=f[0]),e.holder_circle=a,e.holder_char=this,d?this.mod_line_secondary=e:this.mod_lines.push(e),this.draw_objects.push(e)},b.Char.prototype.clearSharedLines=function(){var a;for(a in this.mod_lines)this.mod_lines[a].shared=!1,this.mod_lines[a].visible=!0;this.mod_line_secondary&&(this.mod_line_secondary.shared=!1,this.mod_line_secondary.visible=!0)},b.Char.prototype.shareModLines=function(a){if(!this.mod_lines||this.mod_lines.length<=0||!a.mod_lines||a.mod_lines.length<=0)return!1;for(var c=Math.HALFPI-.3,d=this.up_angle+c,e=this.up_angle-c,f=0;f<this.mod_lines.length;++f){var g=this.mod_lines[f];if(!g.shared){for(var h=0;h<a.mod_lines.length;++h){var i=a.mod_lines[h];if(!i.shared){var j=b.util.angle_between_points(this.x,this.y,a.x,a.y);if(!(e>j||j>d)){var k=a.up_angle+c,l=a.up_angle-c;if(j=b.util.angle_between_points(a.x,a.y,this.x,this.y),!(l>j||j>k)){this.shareLine(g,i);break}}}}if(!g.shared)return!1}}return!0},b.Char.prototype.shareLine=function(a,c){var d=new b.Line(a.holder_circle.center.x,a.holder_circle.center.y,c.holder_circle.center.x,c.holder_circle.center.y),e=d.intersectPoints(a.holder_circle)[0],f=d.intersectPoints(c.holder_circle)[0];a.begin.x=c.begin.x=e.x,a.begin.y=c.begin.x=e.y,a.end.x=c.end.x=f.x,a.end.y=c.end.x=f.y,c.shared=a.shared=!0,c.visible=!1,a.shared_line=c,c.shared_line=a},b.Char.prototype.loadArc=function(a,c,d){var e=0,f=Math.TWOPI,g=d?!1:!0,h=c.intersectPoints(this.word_circle);2==h.length?(this.first_angle=Math.atan2(h[0].y-c.center.y,h[0].x-c.center.x),this.second_angle=Math.atan2(h[1].y-c.center.y,h[1].x-c.center.x),e=this.first_angle,f=this.second_angle,g&&(this.word_intersect_points=[h[0],h[1]])):g&&(this.word_intersect_points=[]);var i=new b.Arc;for(i.circle=c,i.begin_angle=e,i.end_angle=f,this.draw_objects.push(i);e>f;)f+=Math.TWOPI;var j=Math.min(Math.PI/4,(f-e)/2.5);this.loadModifier(a,c,this.up_angle-j,this.up_angle+j)},b.Char.prototype.loadB=function(a){var c=.9*this.consonant_radius,d=new b.Circle(this.x+c*this.up_vector.x,this.y+c*this.up_vector.y,this.consonant_radius);if(this.owner_intersect_object=d,this.loadArc(a,d),this.max_used_word_radius=this.word_circle.radius,this.main_count>1)for(var e=d.radius,f=1;f<this.main_count;++f){e+=2*d.line_width;var g=new b.Circle(d.center.x,d.center.y,e);this.loadArc(null,g,!0)}this.loadSecondaryVowel(d,!0)},b.Char.prototype.loadJ=function(a){var c=.55*this.radius,d=new b.Circle(this.x+c*this.up_vector.x,this.y+c*this.up_vector.y,this.consonant_radius);this.owner_intersect_object=d,this.draw_objects.push(d);var e=Math.PI/4;if(this.loadModifier(a,d,this.up_angle-e,this.up_angle+e),this.max_used_word_radius=this.word_circle.radius,this.main_count>1)for(var f=d.radius,g=1;g<this.main_count;++g){f+=2*d.line_width;var h=new b.Circle(d.center.x,d.center.y,f);this.draw_objects.push(h)}this.loadSecondaryVowel(d)},b.Char.prototype.loadT=function(a){var c=2.3*-this.consonant_radius,d=new b.Circle(this.x+c*this.up_vector.x,this.y+c*this.up_vector.y,3.2*this.consonant_radius);if(this.loadArc(a,d),this.max_used_word_radius=this.word_circle.radius,this.main_count>1)for(var e=d.radius,f=1;f<this.main_count;++f){e+=2*d.line_width;var g=new b.Circle(d.center.x,d.center.y,e);this.loadArc(null,g,!0)}this.loadSecondaryVowel(d)},b.Char.prototype.loadTH=function(a){var c=new b.Circle(this.x,this.y,this.consonant_radius);this.draw_objects.push(c);var d=Math.PI/3;this.loadModifier(a,c,this.up_angle-d,this.up_angle+d),this.max_used_word_radius=this.word_circle.radius+this.consonant_radius,this.loadSecondaryVowel(c)},b.Char.prototype.repeatVowel=function(a,c){function d(a,c,d){if(c>1)for(var e=a.radius,f=1;c>f;++f)if(e-=2*a.line_width,e>0){var g=new b.Circle(a.center.x,a.center.y,e);d.push(g)}}c?d(a,this.secondary_count,this.draw_objects):d(a,this.main_count,this.draw_objects)},b.Char.prototype.loadA=function(a,c){c="boolean"==typeof c?c:!1;var d=1.6,e=new b.Circle(this.x-this.up_vector.x*this.vowel_radius*d,this.y-this.up_vector.y*this.vowel_radius*d,this.vowel_radius);return c&&/^([yzx]|th|ng|qu)$/i.test(this.main)||(this.max_used_word_radius=this.word_circle.radius+this.vowel_radius*d),this.draw_objects.push(e),this.repeatVowel(e,c),e},b.Char.prototype.loadE=function(a,c){c="boolean"==typeof c?c:!1;var d=this.x,e=this.y;c&&(/^([trsvw]|sh)$/i.test(this.main)?(d=this.x+this.up_vector.x*this.vowel_radius,e=this.y+this.up_vector.y*this.vowel_radius):(d=a.center.x,e=a.center.y));var f=new b.Circle(d,e,this.vowel_radius);return c||(this.max_used_word_radius=this.word_circle.radius+this.vowel_radius),this.draw_objects.push(f),this.repeatVowel(f,c),f},b.Char.prototype.loadI=function(a,c){c="boolean"==typeof c?c:!1;var d=this.loadE(a,c);this.dots=[],this.mod_lines=[];var e=Math.PI/12,f=b.util.randomize_angles(1,this.up_angle-e,this.up_angle+e);this.loadModifierLine(d,f[0],!0)},b.Char.prototype.loadO=function(a,c){c="boolean"==typeof c?c:!1;var d=1.5,e=0,f=0;c?(e=a.center.x+this.up_vector.x*a.radius,f=a.center.y+this.up_vector.y*a.radius):(e=this.x+this.up_vector.x*this.vowel_radius*d,f=this.y+this.up_vector.y*this.vowel_radius*d);var g=new b.Circle(e,f,this.vowel_radius);return c&&/^([yzx]|th|ng|qu)$/i.test(this.main)||(this.max_used_word_radius=this.word_circle.radius),this.draw_objects.push(g),this.repeatVowel(g,c),g},b.Char.prototype.loadU=function(a,c){var d=this.loadE(a,c);this.dots=[],this.mod_lines=[];var e=Math.PI/12,f=b.util.randomize_angles(1,this.up_angle+Math.PI-e,this.up_angle+Math.PI+e);this.loadModifierLine(d,f[0],!0)},b.Char.prototype.loadSecondaryVowel=function(a){/^a$/i.test(this.secondary)?this.loadA(this.word_circle,!0):/^e$/i.test(this.secondary)?this.loadE(a,!0):/^i$/i.test(this.secondary)?this.loadI(a,!0):/^o$/i.test(this.secondary)?this.loadO(a,!0):/^u$/i.test(this.secondary)&&this.loadU(a,!0)},b.Char.prototype.loadOther=function(){var a=new b.Point(this.x,this.y);a.line_color="#ff0000",a.line_width=8,this.draw_objects.push(a)},b.Char.prototype.getFirstChar=function(a){if(this.main="",this.main_count=0,this.secondary="",this.secondary_count=0,!(null===a||a.length<=0)){var b=/^[aeiou]/i,c=/^(th|ch|sh|ng|qu)/i,d=a[0];if(b.test(d))this.main=d,this.main_count=this.countCharRepeat(a);else{var e=a.substr(0,2);c.test(e)?(this.main=e,this.main_count=1):(this.main=d,this.main_count=this.countCharRepeat(a));var f=this.main.length*this.main_count;a.length>f&&(d=a[f],b.test(d)&&(this.secondary=d,this.secondary_count=this.countCharRepeat(a,f)))}}},b.Char.prototype.countCharRepeat=function(a,b){b="undefined"!=typeof b?b:0;var c=0,d=0,e=null;if(b>=a.length)return 0;for(c=b;c<a.length;c++)if(c==b)e=a[c],d=1;else{if(e!=a[c])break;d+=1}return d},b.Char.prototype.mouseOverObjects=function(a,b){var c,d,e=[];for(c in this.draw_objects)d=this.draw_objects[c],d.isMouseOver(a,b)&&e.push(d);for(c in this.mod_lines)d=this.mod_lines[c],d.isMouseOver(a,b)&&e.push(d);return this.mod_line_secondary&&this.mod_line_secondary.isMouseOver(a,b)&&e.push(this.mod_line_secondary),e},b.Char.prototype.setLineColor=function(a){var b;for(b in this.draw_objects)this.draw_objects[b].line_color=a;for(b in this.mod_lines)this.mod_lines[b].line_color=a;this.mod_line_secondary&&(this.mod_line_secondary.line_color=a)},b.util={bhaskara:function(a,b,c){if(0!==a){var d=b*b-4*a*c;if(0>d)return[];var e=Math.sqrt(d),f=(-b+e)/(2*a),g=(-b-e)/(2*a);return[f,g]}return 0!==b?[-c/b]:[]},angle_between_points:function(a,c,d,e){var f=d-a,g=e-c;return b.util.normalize_angle(Math.atan2(g,f),0)},normalize_angle:function(a,b){for(;b>a;)a+=Math.TWOPI;for(var c=b+Math.TWOPI;a>c;)a-=Math.TWOPI;return a},points_distance:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},randomize_angles:function(a,b,c){var d=[];if("undefined"==typeof a||0>=a)return d;b="undefined"==typeof b?0:b,c="undefined"==typeof c?Math.TWOPI:c,b>c&&(b-=Math.TWOPI);var e,f=c-b,g=3*a,h=[],i=f/(g-1);for(e=b;c>=e;e+=i)h.push(e);for(e=0;a>e;++e){var j=Math.floor(Math.random()*h.length);d.push(h[j]),h.splice(j,1)}return d},line_equation:function(a,b,c,d){var e={a:0,b:0,vertical:!1},f=c-a,g=d-b;return f>1e-4?(e.a=g/f,e.b=e.a*b+a):(e.a=f/g,e.b=e.a*a+b,e.vertical=!0),e}},b.util.isect_line_circle=function(a,c){var d=[],e=new b.Point,f=new b.Point,g=0,h=0,i=0,j=c.center.y*c.center.y,k=c.center.x*c.center.x,l=c.radius*c.radius;if(Math.abs(a.begin.x-a.end.x)<1e-6){var m=a.begin.x;g=1,h=-2*c.center.y,i=m*m-2*m*c.center.x+k+j-l;var n=b.util.bhaskara(g,h,i);if(2!=n.length)return d;e.x=m,e.y=n[0],f.x=m,f.y=n[1]}else{var o=(a.end.y-a.begin.y)/(a.end.x-a.begin.x),p=a.begin.y-o*a.begin.x;g=o*o+1,h=2*(o*p-o*c.center.y-c.center.x),i=k+j-l-2*p*c.center.y+p*p;var q=b.util.bhaskara(g,h,i);if(2!=q.length)return d;e.x=q[0],e.y=o*e.x+p,f.x=q[1],f.y=o*f.x+p}return[e,f]},b.util.isect_circle_circle=function(a,c){var d=[];if(!a||!c)return d;var e=a.center.x-c.center.x,f=a.center.y-c.center.y,g=Math.sqrt(e*e+f*f);if(1e-6>g||g>a.radius+c.radius||g<Math.abs(a.radius-c.radius))return d;var h=a.radius*a.radius,i=c.radius*c.radius,j=(h-i+g*g)/(g+g),k=Math.sqrt(h-j*j),l=new b.Point,m=new b.Point,n=new b.Point,o=j/g,p=c.center.x-a.center.x,q=c.center.y-a.center.y;l.x=a.center.x+o*p,l.y=a.center.y+o*q;var r=k/g;return m.x=l.x+r*q,n.x=l.x-r*q,m.y=l.y-r*p,n.y=l.y+r*p,[m,n]}}(this);